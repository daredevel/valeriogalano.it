<!DOCTYPE html>
<html>

    <head>
        <title> Switch to mobile, tablet, or other layout in Zend Framework 1.11 &middot; Valerio Galano - Software developer </title>

        <meta http-equiv="content-type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
<meta name="generator" content="Hugo 0.62.0" />


<script src="/js/jquery-3.1.1.min.js"   integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8="   crossorigin="anonymous"></script>


<link rel="stylesheet" href="/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">

<script src="/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>


<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.2/css/all.css" integrity="sha384-fnmOCqbTlWIlj8LyTjo7mOUStjsKC4pOpQbqyi7RrhN7udi9RwhKkMHpvLbHG9Sr" crossorigin="anonymous">


<link rel="stylesheet" href="https://valeriogalano.it/css/nix.css">



<link rel="shortcut icon" href="/img/favicon.ico">








<script type="text/javascript">
    var _iub = _iub || [];
    _iub.csConfiguration = {"lang":"it","siteId":110958,"consentOnLinkAndButton":false,"consentOnElement":null,"consentOnScroll":false,"cookiePolicyId":521121, "banner":{ "acceptButtonDisplay":true,"customizeButtonDisplay":true,"position":"float-top-center","acceptButtonColor":"#0073CE","acceptButtonCaptionColor":"white","customizeButtonColor":"#DADADA","customizeButtonCaptionColor":"#4D4D4D","textColor":"black","backgroundColor":"white" }};
    </script><script type="text/javascript" src="//cdn.iubenda.com/cs/iubenda_cs.js" charset="UTF-8" async></script><meta property="og:title" content="Switch to mobile, tablet, or other layout in Zend Framework 1.11" />
<meta property="og:description" content="The problem We want to implement a method to completely switch layout of our Zend Framework application without loosing flexibility. The solution must give us the possibility of switching all layouts and the views of the controllers we want.Other&#39;s solutions I found some solutions on the Web, but I decided to post this article because no one satisfies my needs. They all resort to ContextSwitch to handle views file names, but, in my applications, I just use ContextSwitch in some actions for other purpose, so I&#39;m unable to apply them without restructure existing code." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://valeriogalano.it/php/switch-to-mobile-tablet-or-other-layout-in-zend-framework-1-11/" />
<meta property="og:image" content="https://valeriogalano.it/img/profile.jpg"/>
<meta property="article:published_time" content="2011-12-12T09:33:10+00:00" />
<meta property="article:modified_time" content="2011-12-12T09:33:10+00:00" /><meta property="og:site_name" content="Valerio Galano" />
<meta itemprop="name" content="Switch to mobile, tablet, or other layout in Zend Framework 1.11">
<meta itemprop="description" content="The problem We want to implement a method to completely switch layout of our Zend Framework application without loosing flexibility. The solution must give us the possibility of switching all layouts and the views of the controllers we want.Other&#39;s solutions I found some solutions on the Web, but I decided to post this article because no one satisfies my needs. They all resort to ContextSwitch to handle views file names, but, in my applications, I just use ContextSwitch in some actions for other purpose, so I&#39;m unable to apply them without restructure existing code.">
<meta itemprop="datePublished" content="2011-12-12T09:33:10&#43;00:00" />
<meta itemprop="dateModified" content="2011-12-12T09:33:10&#43;00:00" />
<meta itemprop="wordCount" content="570">
<meta itemprop="image" content="https://valeriogalano.it/img/profile.jpg"/>



<meta itemprop="keywords" content="" /><meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://valeriogalano.it/img/profile.jpg"/>

<meta name="twitter:title" content="Switch to mobile, tablet, or other layout in Zend Framework 1.11"/>
<meta name="twitter:description" content="The problem We want to implement a method to completely switch layout of our Zend Framework application without loosing flexibility. The solution must give us the possibility of switching all layouts and the views of the controllers we want.Other&#39;s solutions I found some solutions on the Web, but I decided to post this article because no one satisfies my needs. They all resort to ContextSwitch to handle views file names, but, in my applications, I just use ContextSwitch in some actions for other purpose, so I&#39;m unable to apply them without restructure existing code."/>


    </head>

    <body>
        <header>
<nav class="navbar navbar-default navbar-fixed-top navbar-inverse font-header">
	<div class="container-fluid">
		<div class="navbar-header">
			<button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar-collapse-1" aria-expanded="false">
				<span class="sr-only">Toggle navigation</span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
			</button>
			<a class="navbar-brand" id="green-terminal" href=https://valeriogalano.it/>valerio@daredevel ~ $</a>
		</div>

		
		<div class="collapse navbar-collapse" id="navbar-collapse-1">
			<ul class="nav navbar-nav navbar-right">
				<li>
					<a href="https://valeriogalano.it/">/home/valerio</a>
				</li>
				
				
				<li class="dropdown">
                    
            		<a href="/post">~/blog</a>
            		
        		</li>
        		
				
				<li class="dropdown">
                    
            		<a href="https://pensieriincodice.it/">~/podcast</a>
            		
        		</li>
        		

			</ul>
		</div>
	</div>
</nav>
</header>

        <div class="container wrapper">
            <h1><a href="https://valeriogalano.it/php/switch-to-mobile-tablet-or-other-layout-in-zend-framework-1-11/">Switch to mobile, tablet, or other layout in Zend Framework 1.11</a></h1>
            <span class="post-date">Dec 12, 2011 </span>
            <div class="post-content">
                <!-- raw HTML omitted -->
<h2 id="the-problem">The problem</h2>
<p>We want to implement a method to completely switch layout of our Zend Framework application without loosing flexibility. The solution must give us the possibility of switching all layouts and  the views of the controllers we want.<!-- raw HTML omitted --></p>
<!-- raw HTML omitted -->
<h2 id="others-solutions">Other's solutions</h2>
<p>I found some solutions on the Web, but I decided to post this article because no one satisfies my needs. They all resort to ContextSwitch to handle views file names, but, in my applications, I just use ContextSwitch in some actions for other purpose, so I'm unable to apply them without restructure existing code.</p>
<h2 id="my-solution">My solution</h2>
<p>In my implementation I decided to use Zend_Inflector to remap layouts and views file names and give, in this way, the possibility of having a different file for each device the developer wants (desktop, mobile, tablet, etc.). The result for layouts will be a structure like this:</p>
<ul>
<li>/application/layouts/scripts/layout.phtml</li>
<li>/application/layouts/scripts/layout.mobile.phtml</li>
<li>etc.</li>
</ul>
<p>While for each controller the developer decides to involve, the structure will be:</p>
<ul>
<li>/application/views/scripts/controllerX/index.phtml</li>
<li>/application/views/scripts/controllerX/index.mobile.phtml</li>
<li>etc.</li>
<li>/application/views/scripts/controllerY/index.phtml</li>
<li>/application/views/scripts/controllerY/index.mobile.phtml</li>
<li>etc.</li>
</ul>
<h2 id="implementation">Implementation</h2>
<p>I assume you have a valid instance of Zend_Http_UserAgent object in your application.</p>
<p>First of all, we need a controller plugin to switch layouts. Let's create a new file in /library/App/Controller/Plugin called DeviceLayout.php to put the following code into:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-php" data-lang="php"><span class="cp">&lt;?php</span>

 <span class="sd">/**
</span><span class="sd">   * Remap layouts file names based on UserAgent device.
</span><span class="sd">   */</span>
 <span class="k">class</span> <span class="nc">App_Controller_Plugin_DeviceLayout</span> <span class="k">extends</span> <span class="nx">Zend_Controller_Plugin_Abstract</span>
 <span class="p">{</span>
     <span class="k">public</span> <span class="k">function</span> <span class="nf">dispatchLoopStartup</span><span class="p">(</span><span class="nx">Zend_Controller_Request_Abstract</span> <span class="nv">$req</span><span class="p">)</span> <span class="p">{</span>

         <span class="sd">/** @var $userAgent Zend_Http_UserAgent */</span>
         <span class="nv">$userAgent</span> <span class="o">=</span> <span class="nx">Zend_Registry</span><span class="o">::</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;Zend_Http_UserAgent&#39;</span><span class="p">);</span>

         <span class="sd">/** call to initialize browser type */</span>
         <span class="nv">$userAgent</span><span class="o">-&gt;</span><span class="na">getDevice</span><span class="p">();</span>

        <span class="cm">/* if desktop do nothing, so use standard layout file names */</span>
        <span class="k">if</span> <span class="p">(</span><span class="nv">$userAgent</span><span class="o">-&gt;</span><span class="na">getBrowserType</span><span class="p">()</span> <span class="o">===</span> <span class="s1">&#39;desktop&#39;</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nv">$req</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="nv">$layout</span> <span class="o">=</span> <span class="nx">Zend_Layout</span><span class="o">::</span><span class="na">getMvcInstance</span><span class="p">();</span>
        <span class="nv">$inflector</span> <span class="o">=</span> <span class="nv">$layout</span><span class="o">-&gt;</span><span class="na">getInflector</span><span class="p">();</span>
        <span class="nv">$inflector</span><span class="o">-&gt;</span><span class="na">setTarget</span><span class="p">(</span><span class="s1">&#39;:script.:device.:suffix&#39;</span><span class="p">);</span>

        <span class="k">switch</span> <span class="p">(</span><span class="nv">$userAgent</span><span class="o">-&gt;</span><span class="na">getBrowserType</span><span class="p">())</span> <span class="p">{</span>
            <span class="k">default</span><span class="o">:</span>
            <span class="k">case</span> <span class="s1">&#39;mobile&#39;</span><span class="o">:</span>
                <span class="nv">$inflector</span><span class="o">-&gt;</span><span class="na">setStaticRule</span><span class="p">(</span><span class="s1">&#39;device&#39;</span><span class="p">,</span> <span class="s1">&#39;mobile&#39;</span><span class="p">);</span>
                <span class="k">break</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="nv">$req</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div>
<p>Now to activate the plugin, add the following line in your application.ini config file:</p>
<div class="highlight"><pre class="chroma"><code class="language-ini" data-lang="ini"><span class="na">resources.frontController.plugins.devicelayout</span> <span class="o">=</span> <span class="s">&#34;App_Controller_Plugin_DeviceLayout&#34;</span></code></pre></div>
<p>By this point, every time your application will be accessed by mobile or tablet device, the layout will be switched to layout.mobile.phtml or layout.tablet.phtml.</p>
<p>To handle views, instead, we have to edit each controller we want to support devices and add the following code:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-php" data-lang="php">class IndexController extends Zend_Controller_Action
{
    ...
    public function preDispatch()
    {
        /** @var $userAgent Zend_Http_UserAgent */
        $userAgent = Zend_Registry::get(&#39;Zend_Http_UserAgent&#39;);

        /** call to initialize browser type */
        $userAgent-&gt;getDevice();

        /* if desktop do nothing, so use standard layout file names */
        if ($userAgent-&gt;getBrowserType() === &#39;desktop&#39;) {
            return null;
        }

        /** @var $renderer Zend_Controller_Action_Helper_ViewRenderer */
        $renderer = $this-&gt;_helper-&gt;viewRenderer;
        $renderer-&gt;setViewScriptPathNoControllerSpec(&#39;:action.:device.:suffix&#39;);
        $renderer-&gt;setViewScriptPathSpec(&#39;:controller/:action.:device.:suffix&#39;);

        switch ($userAgent-&gt;getBrowserType()) {
            default:
            case &#39;mobile&#39;:
                $renderer-&gt;getInflector()-&gt;setStaticRule(&#39;device&#39;, &#39;mobile&#39;);
                break;
        }
    }
    ...
}</code></pre></td></tr></table>
</div>
</div>
<p>At this point each to different device will be shown a different  view like index.phtml, index.mobile.phtml or index.table.phtml.</p>
<h2 id="conclusion">Conclusion</h2>
<p>Following this article we implemented a flexible solution to switch between different layouts in our Zend Framework application, preserving all other functionalities (specially ContextSwitch). Now all you need to do in implements your new layouts and views!</p>
<p>Of course, all comments are welcome. Obviously, I know that the code can be improved by adding more functionalities, refactoring, etc., but what I would like to analyse and discuss, are the possible limitations of this approach.<!-- raw HTML omitted --></p>

            </div>
            
            <div class="post-comments">
                
<div id="disqus_thread"></div>
<script type="text/plain" class="_iub_cs_activate">

(function() {
    // Don't ever inject Disqus on localhost--it creates unwanted
    // discussions from 'localhost:1313' on your Disqus account...
    if (window.location.hostname == "localhost")
        return;

    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    var disqus_shortname = 'daredevel';
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com/" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

            </div>
            
            <div class="push"></div>
        </div>
        <footer class="footer text-center">
<p>Copyright &copy; 2019 Valerio Galano -
	<span class="credit">
	Powered by
	<a target="_blank" href="https://gohugo.io">Hugo</a>
	and
	<a target="_blank" href="https://github.com/LordMathis/hugo-theme-nix/">Nix</a> theme
</span> -
<a href="https://www.iubenda.com/privacy-policy/521121" class="iubenda-nostyle no-brand iubenda-embed" title="Privacy Policy ">Privacy Policy</a><script type="text/javascript">(function (w,d) {var loader = function () {var s = d.createElement("script"), tag = d.getElementsByTagName("script")[0]; s.src="https://cdn.iubenda.com/iubenda.js"; tag.parentNode.insertBefore(s,tag);}; if(w.addEventListener){w.addEventListener("load", loader, false);}else if(w.attachEvent){w.attachEvent("onload", loader);}else{w.onload = loader;}})(window, document);</script>
</p>
</footer>

    </body>
